<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Campus Poll & Feedback</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
  /* ---- RADIO BUTTON CUSTOM STYLING (plain CSS, works with Tailwind CDN) ---- */
  .radio:checked + span {
    background-color: #2563eb;   /* blue-600 */
    color: #ffffff;
    border-color: #2563eb;
  }
  .radio:checked + span::before {
    content: "Check";
    margin-right: .5rem;
  }

  #toast {
    @apply fixed bottom-6 right-6 px-6 py-3 rounded-xl shadow-2xl text-white opacity-0 transition-all duration-300 z-50 text-sm font-medium;
  }
  #toast.show { @apply opacity-100; }

  @keyframes fadeIn { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:none; } }
  .fade-in { animation: fadeIn .5s ease-out forwards; }
</style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-indigo-900 dark:to-purple-900 text-gray-800 dark:text-gray-100 transition-all duration-500">

<div class="container max-w-5xl mx-auto p-4 sm:p-6">

  <!-- LOGIN -->
  <div id="loginScreen" class="max-w-md mx-auto mt-16 p-8 bg-white dark:bg-gray-800 rounded-3xl shadow-2xl fade-in border border-gray-100 dark:border-gray-700">
    <div class="flex justify-center mb-6">
      <i data-lucide="graduation-cap" class="w-14 h-14 text-indigo-600 dark:text-indigo-400"></i>
    </div>
    <h2 class="text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">Campus Login</h2>
    <form id="authForm" class="space-y-5">
      <input type="email" id="email" placeholder="student1@college.edu / food@ / admin@"
             class="w-full p-4 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 focus:ring-4 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-base"
             required />
      <input type="password" id="password" placeholder="Password" value="1234"
             class="w-full p-4 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 focus:ring-4 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-base"
             required />
      <button type="submit"
              class="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold rounded-xl transition-all transform hover:scale-[1.02] shadow-lg">
        Login
      </button>
    </form>
    <p id="authMsg" class="mt-4 text-center font-medium text-red-600"></p>
    <p class="mt-5 text-xs text-gray-500 dark:text-gray-400 text-center leading-relaxed">
      <strong>Students:</strong> <code class="bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded">student1@college.edu</code>, <code class="bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded">student2@...</code><br>
      <strong>In-charge:</strong> <code class="bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded">food@college.edu</code> etc.<br>
      <strong>Admin:</strong> <code class="bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded">admin@college.edu</code>
    </p>
  </div>

  <!-- STUDENT DASHBOARD -->
  <div id="studentDashboard" class="hidden">
    <header class="flex flex-col sm:flex-row justify-between items-center py-6 border-b border-gray-200 dark:border-gray-700 gap-4">
      <div class="flex items-center space-x-3">
        <i data-lucide="clipboard-check" class="w-9 h-9 text-blue-600 dark:text-blue-400"></i>
        <h1 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">Student Poll</h1>
      </div>
      <div class="flex items-center gap-3">
        <button id="darkToggle" class="p-2.5 rounded-xl bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition">
          <i data-lucide="sun" class="w-5 h-5 hidden dark:inline text-yellow-500"></i>
          <i data-lucide="moon" class="w-5 h-5 dark:hidden text-gray-700"></i>
        </button>
        <button onclick="logout()" class="px-5 py-2.5 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white rounded-xl flex items-center gap-2 transition transform hover:scale-105 shadow-md">
          <i data-lucide="log-out" class="w-4 h-4"></i> Logout
        </button>
      </div>
    </header>

    <div id="studentCategoryButtons" class="flex flex-wrap gap-3 justify-center my-10"></div>
    <div id="studentPollList" class="space-y-6">
      <p class="text-center text-gray-500 dark:text-gray-400 text-lg">Select a category to vote</p>
    </div>
  </div>

  <!-- IN-CHARGE DASHBOARD -->
  <div id="inchargeDashboard" class="hidden">
    <header class="flex flex-col sm:flex-row justify-between items-center py-6 border-b border-gray-200 dark:border-gray-700 gap-4">
      <div class="flex items-center space-x-3">
        <i data-lucide="trending-up" class="w-9 h-9 text-indigo-600 dark:text-indigo-400"></i>
        <h1 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">In-Charge Analytics</h1>
      </div>
      <div class="flex items-center gap-3">
        <button id="darkToggle2" class="p-2.5 rounded-xl bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition">
          <i data-lucide="sun" class="w-5 h-5 hidden dark:inline text-yellow-500"></i>
          <i data-lucide="moon" class="w-5 h-5 dark:hidden text-gray-700"></i>
        </button>
        <button onclick="exportCSV()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-xl flex items-center gap-2 transition">
          <i data-lucide="download" class="w-4 h-4"></i> Export CSV
        </button>
        <button onclick="logout()" class="px-5 py-2.5 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white rounded-xl flex items-center gap-2 transition transform hover:scale-105 shadow-md">
          <i data-lucide="log-out" class="w-4 h-4"></i> Logout
        </button>
      </div>
    </header>

    <h2 id="inchargeTitle" class="text-center text-xl sm:text-2xl font-bold my-10 bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent"></h2>
    <div id="chartsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
  </div>

  <!-- ADMIN PANEL -->
  <div id="adminPanel" class="hidden">
    <header class="flex flex-col sm:flex-row justify-between items-center py-6 border-b border-gray-200 dark:border-gray-700 gap-4">
      <div class="flex items-center space-x-3">
        <i data-lucide="settings" class="w-9 h-9 text-purple-600 dark:text-purple-400"></i>
        <h1 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">Admin Panel</h1>
      </div>
      <button onclick="logout()" class="px-5 py-2.5 bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white rounded-xl flex items-center gap-2 transition transform hover:scale-105 shadow-md">
        <i data-lucide="log-out" class="w-4 h-4"></i> Logout
      </button>
    </header>

    <div class="my-8 p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-lg">
      <h3 class="text-xl font-bold mb-4">Add New Poll</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input id="newQ" placeholder="Question" class="p-3 border rounded-lg">
        <input id="newOpts" placeholder="Options (comma separated)" class="p-3 border rounded-lg">
        <select id="newCat" class="p-3 border rounded-lg"></select>
        <button onclick="addPoll()" class="md:col-span-2 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg">Add Poll</button>
      </div>
    </div>

    <div id="adminPollList" class="space-y-4"></div>
  </div>

</div>

<div id="toast"></div>

<script>
  lucide.createIcons();

  // === DATA ===
  let mockPolls = [
    { id: 'f1', cat: 'food', q: 'Taste of mess food?', opts: ['Excellent', 'Good', 'Average', 'Poor', 'Very Poor'], votes: [], suggestions: [] },
    { id: 'f2', cat: 'food', q: 'Food served hot?', opts: ['Always', 'Mostly', 'Rarely', 'Never'], votes: [], suggestions: [] },
    { id: 'f3', cat: 'food', q: 'Portions sufficient?', opts: ['Yes', 'No', 'Sometimes'], votes: [], suggestions: [] },
    { id: 'f4', cat: 'food', q: 'Dining hygiene?', opts: ['Very Clean', 'Clean', 'Average', 'Dirty'], votes: [], suggestions: [] },
    { id: 'f5', cat: 'food', q: 'Want more veg?', opts: ['Yes', 'No'], votes: [], suggestions: [] },
    { id: 'e1', cat: 'events', q: 'Fest organized?', opts: ['Yes', 'No', 'Partially'], votes: [], suggestions: [] },
    { id: 'e2', cat: 'events', q: 'Events on time?', opts: ['Yes', 'No'], votes: [], suggestions: [] },
    { id: 'e3', cat: 'events', q: 'Cultural quality?', opts: ['Excellent', 'Good', 'Average', 'Poor'], votes: [], suggestions: [] },
    { id: 'e4', cat: 'events', q: 'Prize fair?', opts: ['Yes', 'No'], votes: [], suggestions: [] },
    { id: 'w1', cat: 'wifi', q: 'Hostel Wi-Fi speed?', opts: ['Fast', 'Moderate', 'Slow', 'Unusable'], votes: [], suggestions: [] },
    { id: 'w2', cat: 'wifi', q: 'Classroom Wi-Fi?', opts: ['Available', 'Unstable', 'Not Available'], votes: [], suggestions: [] },
    { id: 'w3', cat: 'wifi', q: 'Login issues?', opts: ['Never', 'Sometimes', 'Always'], votes: [], suggestions: [] },
    { id: 'w4', cat: 'wifi', q: 'Need more points?', opts: ['Yes', 'No'], votes: [], suggestions: [] },
    { id: 'wa1', cat: 'water', q: 'Water 24/7?', opts: ['Yes', 'No'], votes: [], suggestions: [] },
    { id: 'wa2', cat: 'water', q: 'Cooler working?', opts: ['Always', 'Sometimes', 'No'], votes: [], suggestions: [] },
    { id: 'wa3', cat: 'water', q: 'Water taste?', opts: ['Good', 'Average', 'Bad'], votes: [], suggestions: [] },
    { id: 'wa4', cat: 'water', q: 'Need more points?', opts: ['Yes', 'No'], votes: [], suggestions: [] },
    { id: 'a1', cat: 'academics', q: 'Labs equipped?', opts: ['Yes', 'No', 'Partially'], votes: [], suggestions: [] },
    { id: 'a2', cat: 'academics', q: 'Faculty support?', opts: ['Excellent', 'Good', 'Average', 'Poor'], votes: [], suggestions: [] },
    { id: 'a3', cat: 'academics', q: 'Library enough?', opts: ['Yes', 'No'], votes: [], suggestions: [] },
    { id: 'a4', cat: 'academics', q: 'Projectors work?', opts: ['Always', 'Sometimes', 'Never'], votes: [], suggestions: [] },
    { id: 'h1', cat: 'hostel', q: 'Room clean?', opts: ['Very Clean', 'Clean', 'Average', 'Dirty'], votes: [], suggestions: [] },
    { id: 'h2', cat: 'hostel', q: 'Washing machine?', opts: ['Yes', 'No'], votes: [], suggestions: [] },
    { id: 'h3', cat: 'hostel', q: 'Night security?', opts: ['Good', 'Average', 'Poor'], votes: [], suggestions: [] },
    { id: 'h4', cat: 'hostel', q: 'Common room?', opts: ['Good', 'Average', 'Poor'], votes: [], suggestions: [] },
    { id: 'h5', cat: 'hostel', q: 'Better lighting?', opts: ['Yes', 'No'], votes: [], suggestions: [] },
  ];

  const categories = [
    { id: 'food', label: 'Food', incharge: 'food@college.edu' },
    { id: 'events', label: 'Events', incharge: 'events@college.edu' },
    { id: 'wifi', label: 'Wi-Fi', incharge: 'wifi@college.edu' },
    { id: 'water', label: 'Water Facilities', incharge: 'water@college.edu' },
    { id: 'academics', label: 'Academics', incharge: 'academics@college.edu' },
    { id: 'hostel', label: 'Hostel', incharge: 'hostel@college.edu' },
  ];

  let currentUser = null;

  // === UTILS ===
  const $ = s => document.querySelector(s);
  const toast = (msg, type = 'success') => {
    const el = $('#toast');
    el.textContent = msg;
    el.className = `fixed bottom-6 right-6 px-6 py-3 rounded-xl shadow-2xl text-white opacity-0 transition-all duration-300 z-50 text-sm font-medium
                    ${type === 'success' ? 'bg-gradient-to-r from-green-600 to-emerald-600' : 'bg-gradient-to-r from-red-600 to-pink-600'}`;
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 3000);
  };

  const loadPolls = () => {
    const saved = localStorage.getItem('campusPolls');
    if (saved) mockPolls = JSON.parse(saved);
  };
  const savePolls = () => localStorage.setItem('campusPolls', JSON.stringify(mockPolls));

  // === LOGIN (UNLIMITED STUDENTS) ===
  $('#authForm').onsubmit = e => {
    e.preventDefault();
    const email = $('#email').value.trim().toLowerCase();
    const pass = $('#password').value;

    if (pass !== '1234') return toast('Wrong password', 'error');

    // === STUDENT LOGIN: student1@, student2@, student999@ ===
    const studentMatch = email.match(/^student(\d*)@college\.edu$/i);
    if (studentMatch) {
      const num = studentMatch[1] || '1'; // default to 1 if no number
      currentUser = { type: 'student', userId: `student${num}` };
      showStudentDashboard();
    }
    // === ADMIN ===
    else if (email === 'admin@college.edu') {
      currentUser = { type: 'admin' };
      showAdminPanel();
    }
    // === IN-CHARGE ===
    else {
      const cat = categories.find(c => c.incharge === email);
      if (cat) {
        currentUser = { type: 'incharge', cat: cat.id, label: cat.label };
        showInchargeDashboard();
      } else {
        toast('Invalid email', 'error');
      }
    }

    localStorage.setItem('currentUser', JSON.stringify(currentUser));
  };

  const logout = () => {
    if (!confirm('Log out?')) return;
    currentUser = null;
    localStorage.removeItem('currentUser');
    $('#loginScreen').classList.remove('hidden');
    $('#studentDashboard').classList.add('hidden');
    $('#inchargeDashboard').classList.add('hidden');
    $('#adminPanel').classList.add('hidden');
  };

  // === STUDENT DASHBOARD ===
  const showStudentDashboard = () => {
    $('#loginScreen').classList.add('hidden');
    $('#studentDashboard').classList.remove('hidden');
    loadPolls();
    renderStudentCategories();
  };

  const renderStudentCategories = () => {
    const container = $('#studentCategoryButtons');
    container.innerHTML = '';
    categories.forEach(cat => {
      const btn = document.createElement('button');
      btn.className = 'px-6 py-3 rounded-xl font-bold text-blue-700 bg-blue-50 hover:bg-blue-100 dark:bg-gray-700 dark:text-blue-300 dark:hover:bg-gray-600 transition-all flex items-center gap-2 shadow-sm';
      btn.innerHTML = `<i data-lucide="${iconFor(cat.id)}" class="w-5 h-5"></i> ${cat.label}`;
      btn.onclick = (e) => selectStudentCategory(cat.id, e.currentTarget);
      container.appendChild(btn);
    });
    lucide.createIcons();
  };

  const iconFor = id => ({
    food:'utensils', events:'calendar', wifi:'wifi', water:'droplet',
    academics:'graduation-cap', hostel:'home'
  })[id] || 'help-circle';

  let activeBtn = null;
  const selectStudentCategory = (catId, btn) => {
    if (activeBtn) activeBtn.classList.remove('bg-blue-600', 'text-white', 'dark:bg-blue-500');
    btn.classList.add('bg-blue-600', 'text-white', 'dark:bg-blue-500');
    activeBtn = btn;
    const polls = mockPolls.filter(p => p.cat === catId);
    renderStudentPolls(polls);
  };

  const renderStudentPolls = polls => {
    const list = $('#studentPollList');
    list.innerHTML = '';
    const userId = currentUser.userId;

    polls.forEach(poll => {
      const card = document.createElement('div');
      card.className = 'p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-lg space-y-5 border border-gray-100 dark:border-gray-700 fade-in';

      card.innerHTML = `<h4 class="font-bold text-lg flex items-center gap-2 text-gray-800 dark:text-gray-100">
        <i data-lucide="help-circle" class="w-5 h-5 text-blue-600 dark:text-blue-400"></i> ${poll.q}
      </h4>`;

      const hasVoted = poll.votes.some(v => v.userId === userId);
      let selected = null;

      poll.opts.forEach(opt => {
        const label = document.createElement('label');
        label.className = 'flex items-center space-x-3 cursor-pointer group';
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = `poll_${poll.id}`;
        radio.value = opt;
        radio.className = 'radio hidden';
        radio.disabled = hasVoted;
        radio.onchange = () => selected = opt;

        const span = document.createElement('span');
        span.className = 'flex items-center px-5 py-3 rounded-xl border-2 border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 group-hover:bg-gray-100 dark:group-hover:bg-gray-600 transition-all w-full text-gray-700 dark:text-gray-300 font-medium';
        span.innerHTML = `<span></span>${opt}`;
        label.append(radio, span);
        card.appendChild(label);
      });

      if (!hasVoted) {
        const suggInput = document.createElement('textarea');
        suggInput.placeholder = 'Your suggestion (optional)';
        suggInput.className = 'mt-3 w-full p-3 border rounded-lg text-sm';

        const voteBtn = document.createElement('button');
        voteBtn.className = 'mt-2 w-full py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold rounded-xl flex items-center justify-center gap-2 transition-all transform hover:scale-105 shadow-md';
        voteBtn.innerHTML = `<i data-lucide="check-circle" class="w-5 h-5"></i> Submit Vote`;
        voteBtn.onclick = () => {
          if (!selected) return toast('Select an option', 'error');
          poll.votes.push({ userId, choice: selected });
          if (suggInput.value.trim()) {
            poll.suggestions = poll.suggestions || [];
            poll.suggestions.push({ userId, option: selected, text: suggInput.value.trim() });
          }
          savePolls();
          toast('Vote recorded!', 'success');
          selectStudentCategory(poll.cat, activeBtn);
        };
        card.appendChild(suggInput);
        card.appendChild(voteBtn);
      } else {
        const choice = poll.votes.find(v => v.userId === userId).choice;
        card.innerHTML += `<p class="mt-4 text-sm text-green-600 dark:text-green-400 flex items-center gap-2 font-medium">
          <i data-lucide="check" class="w-5 h-5"></i> <strong>You voted:</strong> ${choice}
        </p>`;
      }

      list.appendChild(card);
    });
    lucide.createIcons();
  };

  // === IN-CHARGE, ADMIN, CHARTS, CSV, DARK MODE === (same as before)
  // ... [All other functions unchanged]

  // === IN-CHARGE DASHBOARD ===
  const showInchargeDashboard = () => {
    $('#loginScreen').classList.add('hidden');
    $('#inchargeDashboard').classList.remove('hidden');
    $('#inchargeTitle').textContent = `${currentUser.label} â€“ Live Poll Results`;
    loadPolls();
    renderCharts();
  };

  const colorPalette = i => {
    const hues = [210, 120, 60, 0, 280, 340, 160, 40, 300, 180];
    return `hsl(${hues[i % hues.length]}, 70%, 58%)`;
  };

  const renderCharts = () => {
    const container = $('#chartsContainer');
    container.innerHTML = '';
    const polls = mockPolls.filter(p => p.cat === currentUser.cat);

    polls.forEach((poll, idx) => {
      const counts = {};
      poll.opts.forEach(o => counts[o] = 0);
      poll.votes.forEach(v => counts[v.choice]++);

      const total = poll.votes.length;
      const data = poll.opts.map(opt => ({
        label: opt,
        value: total ? (counts[opt] / total * 100).toFixed(1) : 0
      }));

      const card = document.createElement('div');
      card.className = 'p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-lg flex flex-col items-center border border-gray-100 dark:border-gray-700 fade-in';
      card.innerHTML = `
        <h4 class="mb-5 font-bold text-lg flex items-center gap-2 text-gray-800 dark:text-gray-100">
          <i data-lucide="pie-chart" class="w-5 h-5 text-indigo-600 dark:text-indigo-400"></i> ${poll.q}
        </h4>
        <div class="w-full max-w-xs h-64"><canvas id="chart_${poll.id}"></canvas></div>
        <p class="mt-4 text-sm font-medium text-gray-600 dark:text-gray-400"><strong>Total votes:</strong> ${total}</p>
      `;
      container.appendChild(card);

      const ctx = document.getElementById(`chart_${poll.id}`).getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: data.map(d => `${d.label} (${d.value}%)`),
          datasets: [{
            data: data.map(d => d.value),
            backgroundColor: data.map((_, i) => colorPalette(i + idx * 5)),
            borderWidth: 3,
            borderColor: 'rgba(255,255,255,0.8)',
            hoverOffset: 8
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom', labels: { padding: 20, font: { size: 13 } } }
          }
        }
      });
    });
    lucide.createIcons();
  };

  const exportCSV = () => {
    let csv = "Poll ID,Question,Option,Votes,Percentage,Suggestions\n";
    mockPolls.filter(p => p.cat === currentUser.cat).forEach(poll => {
      const total = poll.votes.length;
      poll.opts.forEach(opt => {
        const count = poll.votes.filter(v => v.choice === opt).length;
        const perc = total ? (count / total * 100).toFixed(1) : 0;
        const suggs = (poll.suggestions || []).filter(s => s.option === opt).map(s => s.text).join(' | ');
        csv += `${poll.id},"${poll.q}","${opt}",${count},${perc},"${suggs}"\n`;
      });
    });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `${currentUser.label}_results.csv`;
    a.click();
    toast('CSV exported!', 'success');
  };

  // === ADMIN PANEL ===
  const showAdminPanel = () => {
    $('#loginScreen').classList.add('hidden');
    $('#adminPanel').classList.remove('hidden');
    renderAdminPolls();
    const catSelect = $('#newCat');
    catSelect.innerHTML = categories.map(c => `<option value="${c.id}">${c.label}</option>`).join('');
  };

  const addPoll = () => {
    const q = $('#newQ').value.trim();
    const opts = $('#newOpts').value.split(',').map(o => o.trim()).filter(o => o);
    const cat = $('#newCat').value;
    if (!q || opts.length < 2) return toast('Enter question + 2+ options', 'error');
    const id = cat[0] + (mockPolls.filter(p => p.cat === cat).length + 1);
    mockPolls.push({ id, cat, q, opts, votes: [], suggestions: [] });
    savePolls();
    $('#newQ').value = $('#newOpts').value = '';
    renderAdminPolls();
    toast('Poll added!', 'success');
  };

  const renderAdminPolls = () => {
    const list = $('#adminPollList');
    list.innerHTML = '';
    mockPolls.forEach(poll => {
      const card = document.createElement('div');
      card.className = 'p-4 bg-white dark:bg-gray-800 rounded-xl shadow-md flex justify-between items-center';
      card.innerHTML = `
        <div>
          <strong>${poll.q}</strong> <span class="text-sm text-gray-500">(${poll.cat})</span>
          <p class="text-xs text-gray-600">Options: ${poll.opts.join(', ')}</p>
        </div>
        <button onclick="deletePoll('${poll.id}')" class="text-red-600 hover:text-red-700">
          <i data-lucide="trash-2" class="w-5 h-5"></i>
        </button>
      `;
      list.appendChild(card);
    });
    lucide.createIcons();
  };

  const deletePoll = id => {
    if (!confirm('Delete this poll?')) return;
    mockPolls = mockPolls.filter(p => p.id !== id);
    savePolls();
    renderAdminPolls();
    toast('Poll deleted', 'success');
  };

  // === DARK MODE ===
  const setDark = on => {
    document.documentElement.classList.toggle('dark', on);
    localStorage.setItem('darkMode', on);
    lucide.createIcons();
  };
  $('#darkToggle, #darkToggle2').forEach(btn => {
    btn.onclick = () => setDark(!document.documentElement.classList.contains('dark'));
  });

  // === ON LOAD ===
  window.onload = () => {
    loadPolls();
    const saved = localStorage.getItem('currentUser');
    if (saved) {
      currentUser = JSON.parse(saved);
      if (currentUser.type === 'student') showStudentDashboard();
      else if (currentUser.type === 'incharge') showInchargeDashboard();
      else if (currentUser.type === 'admin') showAdminPanel();
    }
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const savedDark = localStorage.getItem('darkMode');
    setDark(savedDark !== null ? savedDark === 'true' : prefersDark);
  };
</script>

</body>
</html>